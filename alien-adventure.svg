<svg width="877" height="728" viewBox="0 0 877 728" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="877" height="728" fill="white"/>

<defs>
<style>
  #helmet { cursor: pointer; }
  #helmet:hover { filter: brightness(1.15); }
  #alien.draggable { cursor: grab; }
  #alien.draggable:hover { filter: brightness(1.05); }
  #alien.dragging { cursor: grabbing; }
  #planet.clickable { cursor: pointer; }
  #planet.clickable:hover { filter: brightness(1.1); }
</style>
</defs>

<!-- Standalone Helmet (clickable) -->
<g id="helmet">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M181.06 59.0645C212.761 59.0645 238.46 84.7626 238.46 116.464C238.46 148.165 212.761 173.863 181.06 173.863C149.359 173.863 123.661 148.165 123.661 116.464C123.661 84.7626 149.359 59.0645 181.06 59.0645Z" fill="#00CCFF" fill-opacity="0.301961"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M168.545 106.106C174.882 106.106 180.021 111.244 180.021 117.581C180.021 123.918 174.883 129.057 168.545 129.057C162.208 129.057 157.07 123.919 157.07 117.581C157.07 111.244 162.208 106.106 168.545 106.106Z" fill="white" fill-opacity="0.501961"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M181.06 59.0645C205.851 59.0645 226.969 74.7809 234.999 96.7921H127.121C135.151 74.7809 156.269 59.0645 181.06 59.0645Z" fill="#33CC99" stroke="#33CC99" stroke-width="4" stroke-miterlimit="2.61313"/>
  <path d="M181.06 59.0642V38.1953" stroke="#33CC99" stroke-width="4" stroke-miterlimit="2.61313"/>
  <path d="M181.06 44.3903C184.481 44.3903 187.255 41.6166 187.255 38.1951C187.255 34.7737 184.481 32 181.06 32C177.638 32 174.865 34.7737 174.865 38.1951C174.865 41.6166 177.638 44.3903 181.06 44.3903Z" fill="#33CC99"/>
</g>

<!-- Alien -->
<g id="alien">
  <!-- Alien Body -->
  <g id="alien-body">
    <path d="M271.119 322.961H91V351.112H271.119V322.961Z" fill="#33CC99"/>
    <path d="M244.026 306.464H118.092V389.268H244.026V306.464Z" fill="#33CC99"/>
    <path d="M181.06 354.607C207.649 354.607 229.203 333.053 229.203 306.464C229.203 279.875 207.649 258.32 181.06 258.32C154.471 258.32 132.917 279.875 132.917 306.464C132.917 333.053 154.471 354.607 181.06 354.607Z" fill="#33CC99"/>
    <path d="M181.06 335.622C197.164 335.622 210.218 322.567 210.218 306.463C210.218 290.359 197.164 277.305 181.06 277.305C164.956 277.305 151.901 290.359 151.901 306.463C151.901 322.567 164.956 335.622 181.06 335.622Z" fill="#FFCC00"/>
    <path d="M181.06 316.024C186.34 316.024 190.621 311.744 190.621 306.463C190.621 301.183 186.34 296.902 181.06 296.902C175.78 296.902 171.499 301.183 171.499 306.463C171.499 311.744 175.78 316.024 181.06 316.024Z" fill="black" stroke="#373435" stroke-width="0.666667" stroke-miterlimit="2.61313"/>
    <path d="M109.346 351.112H99.249V419.567H109.346V351.112Z" fill="#333300"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M187.824 389.268H213.554V470.498H200.689C193.614 470.498 187.824 464.71 187.824 457.633V389.268Z" fill="#333300"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M174.295 389.268H148.565V470.498H161.43C168.505 470.498 174.295 464.71 174.295 457.633V389.268Z" fill="#333300"/>
    <path d="M104.298 420.576C109.328 420.576 113.406 416.498 113.406 411.467C113.406 406.437 109.328 402.358 104.298 402.358C99.2671 402.358 95.189 406.437 95.189 411.467C95.189 416.498 99.2671 420.576 104.298 420.576Z" fill="#333300"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M104.298 423.983L95.4474 432.834C93.0998 430.486 91.7817 427.303 91.7817 423.983C91.7817 417.069 97.3854 411.467 104.298 411.467C111.211 411.467 116.814 417.07 116.814 423.983C116.814 427.302 115.495 430.486 113.149 432.834L104.298 423.983Z" fill="#66FFCC"/>
    <path d="M104.298 408.192C108.435 408.192 111.789 404.838 111.789 400.7C111.789 396.562 108.435 393.208 104.298 393.208C100.16 393.208 96.8057 396.562 96.8057 400.7C96.8057 404.838 100.16 408.192 104.298 408.192Z" fill="#333300"/>
    <path d="M261.974 351.112H251.877V419.567H261.974V351.112Z" fill="#333300"/>
    <path d="M256.925 420.576C261.956 420.576 266.034 416.498 266.034 411.467C266.034 406.437 261.956 402.358 256.925 402.358C251.895 402.358 247.816 406.437 247.816 411.467C247.816 416.498 251.895 420.576 256.925 420.576Z" fill="#333300"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M256.925 423.983L248.074 432.834C245.727 430.486 244.409 427.303 244.409 423.983C244.409 417.069 250.012 411.467 256.925 411.467C263.838 411.467 269.441 417.07 269.441 423.983C269.441 427.302 268.122 430.486 265.776 432.834L256.925 423.983Z" fill="#66FFCC"/>
    <path d="M256.925 408.192C261.063 408.192 264.417 404.838 264.417 400.7C264.417 396.562 261.063 393.208 256.925 393.208C252.787 393.208 249.433 396.562 249.433 400.7C249.433 404.838 252.787 408.192 256.925 408.192Z" fill="#333300"/>
    <path d="M95.1911 322.961H91V351.112H95.1911V322.961Z" fill="#FFCC00"/>
    <path d="M271.119 322.961H266.928V351.112H271.119V322.961Z" fill="#FFCC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M149.541 470.499H123.877C123.877 456.383 135.426 444.835 149.541 444.835V470.499Z" fill="#333300"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M212.376 470.499H238.04C238.04 456.383 226.491 444.835 212.376 444.835V470.499Z" fill="#333300"/>
  </g>
  <!-- Helmet on alien head (hidden until helmet is clicked) -->
  <g id="alien-helmet-on" style="display:none">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M181.06 249.064C212.761 249.064 238.46 274.763 238.46 306.463C238.46 338.164 212.761 363.862 181.06 363.862C149.359 363.862 123.661 338.164 123.661 306.463C123.661 274.763 149.359 249.064 181.06 249.064Z" fill="#00CCFF" fill-opacity="0.301961"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M168.545 296.105C174.882 296.105 180.021 301.243 180.021 307.581C180.021 313.919 174.883 319.056 168.545 319.056C162.208 319.056 157.07 313.919 157.07 307.581C157.07 301.244 162.208 296.105 168.545 296.105Z" fill="white" fill-opacity="0.501961"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M181.06 249.064C205.851 249.064 226.969 264.78 234.999 286.792H127.121C135.151 264.781 156.269 249.064 181.06 249.064Z" fill="#33CC99" stroke="#33CC99" stroke-width="4" stroke-miterlimit="2.61313"/>
    <path d="M181.06 249.064V228.195" stroke="#33CC99" stroke-width="4" stroke-miterlimit="2.61313"/>
    <path d="M181.06 234.39C184.481 234.39 187.255 231.617 187.255 228.195C187.255 224.774 184.481 222 181.06 222C177.638 222 174.865 224.774 174.865 228.195C174.865 231.617 177.638 234.39 181.06 234.39Z" fill="#33CC99"/>
  </g>
</g>

<!-- Ship Group (entire ship: base + dome + alien-in-ship, all move together) -->
<g id="ship-group">
  <!-- Ship Base (ground platform + landing lights) -->
  <g id="ship-base">
    <path d="M450.58 665.552C602.778 665.552 726.159 644.807 726.159 619.218C726.159 593.629 602.778 572.885 450.58 572.885C298.381 572.885 175 593.629 175 619.218C175 644.807 298.381 665.552 450.58 665.552Z" fill="#33CC99"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M726.159 619.219C726.159 644.808 602.778 665.552 450.58 665.552C298.381 665.552 175 644.808 175 619.219H726.16H726.159Z" fill="#333300"/>
    <path d="M445.425 625.727C449.02 625.727 451.934 622.813 451.934 619.218C451.934 615.623 449.02 612.709 445.425 612.709C441.83 612.709 438.916 615.623 438.916 619.218C438.916 622.813 441.83 625.727 445.425 625.727Z" fill="#FFCC00"/>
    <path d="M514.299 625.727C517.894 625.727 520.808 622.813 520.808 619.218C520.808 615.623 517.894 612.709 514.299 612.709C510.704 612.709 507.79 615.623 507.79 619.218C507.79 622.813 510.704 625.727 514.299 625.727Z" fill="#FFCC00"/>
    <path d="M379.456 625.727C383.051 625.727 385.966 622.813 385.966 619.218C385.966 615.623 383.051 612.709 379.456 612.709C375.862 612.709 372.947 615.623 372.947 619.218C372.947 622.813 375.862 625.727 379.456 625.727Z" fill="#FFCC00"/>
    <path d="M570.406 625.727C574.001 625.727 576.915 622.813 576.915 619.218C576.915 615.623 574.001 612.709 570.406 612.709C566.811 612.709 563.896 615.623 563.896 619.218C563.896 622.813 566.811 625.727 570.406 625.727Z" fill="#FFCC00"/>
    <path d="M320.249 625.727C323.844 625.727 326.758 622.813 326.758 619.218C326.758 615.623 323.844 612.709 320.249 612.709C316.654 612.709 313.74 615.623 313.74 619.218C313.74 622.813 316.654 625.727 320.249 625.727Z" fill="#FFCC00"/>
  </g>
  <!-- Alien in ship (hidden until alien is dropped on ship) -->
  <g id="alien-in-ship" style="display:none">
    <path d="M515.174 538.434H384.958V558.785H515.174V538.434Z" fill="#33CC99"/>
    <path d="M495.588 526.507H404.545V586.369H495.588V526.507Z" fill="#33CC99"/>
    <path d="M450.066 561.312C469.288 561.312 484.871 545.729 484.871 526.507C484.871 507.285 469.288 491.702 450.066 491.702C430.844 491.702 415.261 507.285 415.261 526.507C415.261 545.729 430.844 561.312 450.066 561.312Z" fill="#33CC99"/>
    <path d="M450.066 547.586C461.708 547.586 471.145 538.149 471.145 526.507C471.145 514.865 461.708 505.428 450.066 505.428C438.424 505.428 428.987 514.865 428.987 526.507C428.987 538.149 438.424 547.586 450.066 547.586Z" fill="#FFCC00"/>
    <path d="M450.066 533.419C453.884 533.419 456.978 530.324 456.978 526.507C456.978 522.69 453.884 519.596 450.066 519.596C446.249 519.596 443.155 522.69 443.155 526.507C443.155 530.324 446.249 533.419 450.066 533.419Z" fill="black" stroke="#373435" stroke-width="0.666667" stroke-miterlimit="2.61313"/>
    <path d="M398.221 558.785H390.922V608.273H398.221V558.785Z" fill="#333300"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M454.957 586.37H473.558V645.095H464.257C459.143 645.095 454.958 640.91 454.958 635.795V586.37H454.957Z" fill="#333300"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M445.176 586.37H426.574V645.095H435.875C440.99 645.095 445.175 640.91 445.175 635.795V586.37H445.176Z" fill="#333300"/>
    <path d="M394.571 609.004C398.208 609.004 401.157 606.055 401.157 602.418C401.157 598.781 398.208 595.833 394.571 595.833C390.934 595.833 387.986 598.781 387.986 602.418C387.986 606.055 390.934 609.004 394.571 609.004Z" fill="#333300"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M394.571 611.468L388.173 617.866C386.477 616.169 385.522 613.867 385.522 611.468C385.522 606.47 389.573 602.419 394.571 602.419C399.569 602.419 403.62 606.47 403.62 611.468C403.62 613.867 402.667 616.169 400.97 617.866L394.571 611.468Z" fill="#66FFCC"/>
    <path d="M394.571 600.05C397.562 600.05 399.987 597.625 399.987 594.634C399.987 591.643 397.562 589.219 394.571 589.219C391.58 589.219 389.156 591.643 389.156 594.634C389.156 597.625 391.58 600.05 394.571 600.05Z" fill="#333300"/>
    <path d="M508.562 558.785H501.264V608.273H508.562V558.785Z" fill="#333300"/>
    <path d="M504.913 609.004C508.55 609.004 511.498 606.055 511.498 602.418C511.498 598.781 508.55 595.833 504.913 595.833C501.276 595.833 498.328 598.781 498.328 602.418C498.328 606.055 501.276 609.004 504.913 609.004Z" fill="#333300"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M504.913 611.468L498.515 617.866C496.817 616.169 495.864 613.867 495.864 611.468C495.864 606.47 499.915 602.419 504.913 602.419C509.91 602.419 513.962 606.47 513.962 611.468C513.962 613.867 513.009 616.169 511.311 617.866L504.913 611.468Z" fill="#66FFCC"/>
    <path d="M504.913 600.05C507.904 600.05 510.328 597.625 510.328 594.634C510.328 591.643 507.904 589.219 504.913 589.219C501.922 589.219 499.497 591.643 499.497 594.634C499.497 597.625 501.922 600.05 504.913 600.05Z" fill="#333300"/>
    <path d="M387.989 538.434H384.958V558.785H387.989V538.434Z" fill="#FFCC00"/>
    <path d="M515.175 538.434H512.145V558.785H515.175V538.434Z" fill="#FFCC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M427.281 645.095H408.728C408.728 634.891 417.077 626.542 427.281 626.542V645.095Z" fill="#333300"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M472.706 645.095H491.258C491.258 634.891 482.91 626.542 472.706 626.542V645.095Z" fill="#333300"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M450.066 485.012C472.984 485.012 491.562 503.59 491.562 526.508C491.562 549.425 472.984 568.005 450.066 568.005C427.149 568.005 408.57 549.426 408.57 526.508C408.57 503.59 427.149 485.012 450.066 485.012Z" fill="#00CCFF" fill-opacity="0.301961"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M441.018 519.02C445.601 519.02 449.314 522.734 449.314 527.315C449.314 531.898 445.601 535.611 441.018 535.611C436.436 535.611 432.723 531.897 432.723 527.315C432.723 522.733 436.437 519.02 441.018 519.02Z" fill="white" fill-opacity="0.501961"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M450.066 485.012C467.988 485.012 483.255 496.374 489.061 512.287H411.072C416.877 496.374 432.145 485.012 450.067 485.012H450.066Z" fill="#33CC99" stroke="#33CC99" stroke-width="4" stroke-miterlimit="2.61313"/>
    <path d="M450.066 485.011V469.924" stroke="#33CC99" stroke-width="4" stroke-miterlimit="2.61313"/>
    <path d="M450.066 474.403C452.54 474.403 454.545 472.397 454.545 469.924C454.545 467.45 452.54 465.445 450.066 465.445C447.593 465.445 445.587 467.45 445.587 469.924C445.587 472.397 447.593 474.403 450.066 474.403Z" fill="#33CC99"/>
  </g>
  <!-- Ship Dome -->
  <path id="ship-dome" fill-rule="evenodd" clip-rule="evenodd" d="M450.579 452C508.676 452 555.773 499.097 555.773 557.193C555.773 615.29 508.676 662.386 450.579 662.386C392.483 662.386 345.386 615.29 345.386 557.193C345.386 499.097 392.483 452 450.579 452Z" fill="#99FFFF" fill-opacity="0.501961"/>
</g>

<!-- Planet (clickable for Scene 2) -->
<g id="planet">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M672.765 122.19C729.059 122.19 774.694 167.826 774.694 224.119C774.694 280.413 729.059 326.048 672.765 326.048C616.471 326.048 570.836 280.413 570.836 224.119C570.836 167.826 616.471 122.19 672.765 122.19Z" fill="#99FFFF" fill-opacity="0.301961"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M672.765 129.662C724.933 129.662 767.222 171.952 767.222 224.12C767.222 276.287 724.933 318.577 672.765 318.577C620.597 318.577 578.308 276.287 578.308 224.12C578.308 171.952 620.597 129.662 672.765 129.662Z" fill="#99FFFF" fill-opacity="0.8"/>
  <path d="M672.765 313.04C721.875 313.04 761.686 273.229 761.686 224.119C761.686 175.009 721.875 135.198 672.765 135.198C623.655 135.198 583.844 175.009 583.844 224.119C583.844 273.229 623.655 313.04 672.765 313.04Z" fill="#00CCFF"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M716.613 301.491C703.673 308.84 688.71 313.041 672.766 313.041C658.331 313.041 644.701 309.598 632.647 303.493C641.992 298.286 654.83 294.664 666.347 293.88C684.784 292.626 699.834 298.647 713.191 300.967C714.343 301.167 715.482 301.339 716.614 301.49L716.613 301.491ZM756.339 254.557C752.274 265.715 746.036 275.826 738.141 284.387C729.864 282.095 720.955 279.483 712.635 277.728C692.129 273.401 675.198 274.279 660.038 275.119C644.879 275.96 631.491 276.761 618.824 282.531C615.857 283.881 612.932 285.505 610.069 287.173C601.429 278.582 594.543 268.228 590.001 256.693C600.853 250.138 615.707 245.533 629.485 244.492C650.242 242.924 668.553 249.446 683.602 248.944C698.652 248.442 710.442 240.917 723.548 240.792C734.743 240.684 746.897 245.978 756.34 254.558L756.339 254.557ZM754.223 188.42C759.019 199.348 761.687 211.421 761.687 224.12C761.687 225.599 761.648 227.069 761.578 228.531C744.652 226.438 727.869 219.151 712.916 218.581C695.86 217.932 681.186 226.025 664.881 229.122C648.577 232.22 630.642 230.321 610.324 231.62C601.71 232.171 592.667 233.296 584.406 234.105C584.04 230.826 583.845 227.495 583.845 224.119C583.845 213.178 585.826 202.699 589.441 193.018C596.996 190.559 604.927 189.367 612.331 190.105C628.887 191.753 642.808 203.044 653.656 202.944C664.505 202.844 672.281 191.355 683.443 183.811C694.605 176.267 709.153 172.671 718.999 175.419C728.844 178.166 733.987 187.258 747.28 188.408C749.406 188.592 751.742 188.571 754.223 188.42ZM672.766 135.198C691.57 135.198 709.007 141.04 723.372 151.001C722.862 151.177 722.356 151.347 721.853 151.51C705.299 156.904 693.635 155.523 680.277 157.844C666.921 160.164 651.87 166.184 633.434 164.93C626.045 164.427 618.114 162.755 610.908 160.247C626.913 144.744 648.723 135.198 672.765 135.198H672.766Z" fill="#66FFCC" fill-opacity="0.501961"/>
</g>

<script><![CDATA[
(function() {
  var svg = document.querySelector('svg');
  var helmet = document.getElementById('helmet');
  var alien = document.getElementById('alien');
  var alienHelmetOn = document.getElementById('alien-helmet-on');
  var alienInShip = document.getElementById('alien-in-ship');
  var shipGroup = document.getElementById('ship-group');
  var shipDome = document.getElementById('ship-dome');
  var planet = document.getElementById('planet');

  var helmetAttached = false;
  var alienInShipState = false;
  var isDragging = false;
  var dragStartX = 0, dragStartY = 0;
  var alienOffsetX = 0, alienOffsetY = 0;

  // Convert screen coordinates to SVG coordinates
  function toSVG(evt) {
    var pt = svg.createSVGPoint();
    if (evt.touches && evt.touches.length > 0) {
      pt.x = evt.touches[0].clientX;
      pt.y = evt.touches[0].clientY;
    } else {
      pt.x = evt.clientX;
      pt.y = evt.clientY;
    }
    return pt.matrixTransform(svg.getScreenCTM().inverse());
  }

  // Ease in-out quad
  function ease(t) {
    return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
  }

  // ===== SCENE 1: Click Helmet to Attach =====
  helmet.addEventListener('click', function() {
    if (helmetAttached) return;

    // Animate helmet translating down ~190px to align with alien's head
    var duration = 1000;
    var startTime = performance.now();

    function animateHelmet(now) {
      var t = Math.min((now - startTime) / duration, 1);
      var y = 190 * ease(t);
      helmet.setAttribute('transform', 'translate(0,' + y + ')');
      if (t < 1) {
        requestAnimationFrame(animateHelmet);
      } else {
        // Hide standalone helmet, show helmet on alien's head
        helmet.style.display = 'none';
        alienHelmetOn.style.display = '';
        helmetAttached = true;
        alien.classList.add('draggable');
      }
    }
    requestAnimationFrame(animateHelmet);
  });

  // ===== SCENE 1: Drag Alien to Ship =====
  function onDragStart(evt) {
    if (!helmetAttached || alienInShipState) return;
    isDragging = true;
    alien.classList.add('dragging');
    var pt = toSVG(evt);
    dragStartX = pt.x - alienOffsetX;
    dragStartY = pt.y - alienOffsetY;
    evt.preventDefault();
  }

  function onDragMove(evt) {
    if (!isDragging) return;
    var pt = toSVG(evt);
    alienOffsetX = pt.x - dragStartX;
    alienOffsetY = pt.y - dragStartY;
    alien.setAttribute('transform', 'translate(' + alienOffsetX + ',' + alienOffsetY + ')');

    // Highlight ship dome when alien is near
    var alienCX = 181 + alienOffsetX;
    var alienCY = 350 + alienOffsetY;
    var shipCX = 450.579;
    var shipCY = 557.193;
    var dist = Math.sqrt(Math.pow(alienCX - shipCX, 2) + Math.pow(alienCY - shipCY, 2));
    if (dist < 200) {
      shipDome.setAttribute('fill-opacity', '0.75');
    } else {
      shipDome.setAttribute('fill-opacity', '0.501961');
    }
    evt.preventDefault();
  }

  function onDragEnd(evt) {
    if (!isDragging) return;
    isDragging = false;
    alien.classList.remove('dragging');
    shipDome.setAttribute('fill-opacity', '0.501961');

    // Check if alien was dropped near the ship dome
    var alienCX = 181 + alienOffsetX;
    var alienCY = 350 + alienOffsetY;
    var shipCX = 450.579;
    var shipCY = 557.193;
    var dist = Math.sqrt(Math.pow(alienCX - shipCX, 2) + Math.pow(alienCY - shipCY, 2));

    if (dist < 180) {
      // Alien enters the ship
      alien.style.display = 'none';
      alienInShip.style.display = '';
      alienInShipState = true;
      planet.classList.add('clickable');
      shipGroup.style.cursor = 'pointer';
    } else {
      // Snap back to original position with animation
      var fromX = alienOffsetX;
      var fromY = alienOffsetY;
      var snapDuration = 300;
      var snapStart = performance.now();

      function snapBack(now) {
        var t = Math.min((now - snapStart) / snapDuration, 1);
        var et = ease(t);
        var x = fromX * (1 - et);
        var y = fromY * (1 - et);
        alien.setAttribute('transform', 'translate(' + x + ',' + y + ')');
        if (t < 1) {
          requestAnimationFrame(snapBack);
        } else {
          alienOffsetX = 0;
          alienOffsetY = 0;
        }
      }
      requestAnimationFrame(snapBack);
    }
  }

  // Mouse events
  alien.addEventListener('mousedown', onDragStart);
  svg.addEventListener('mousemove', onDragMove);
  svg.addEventListener('mouseup', onDragEnd);

  // Touch events
  alien.addEventListener('touchstart', onDragStart);
  svg.addEventListener('touchmove', onDragMove);
  svg.addEventListener('touchend', onDragEnd);

  // ===== SCENE 2: Click Planet or Ship - Ship Orbits and Flies =====
  function launchShip() {
    if (!alienInShipState) return;
    alienInShipState = false; // Prevent re-clicking
    shipGroup.style.cursor = '';

    // Move ship-group to end of SVG so it renders on top of everything
    svg.appendChild(shipGroup);

    // Orbit waypoints: translate offsets from ship's original position
    // Ship dome center is at ~(450, 557). We orbit along screen edges then fly to planet at ~(673, 224).
    var waypoints = [
      { x: 0, y: 0, opacity: 1 },
      { x: 0, y: 100, opacity: 1 },          // down to bottom edge
      { x: -380, y: 100, opacity: 1 },        // bottom-left corner
      { x: -380, y: -500, opacity: 1 },       // top-left corner
      { x: 370, y: -500, opacity: 1 },        // top-right corner
      { x: 370, y: 100, opacity: 1 },         // bottom-right corner
      { x: 0, y: 0, opacity: 1 },             // back to start
      { x: 222, y: -333, opacity: 1 },        // fly to planet
      { x: 222, y: -333, opacity: 0 }         // fade out at planet
    ];

    var durations = [400, 700, 900, 900, 900, 700, 800, 600];
    var wpIndex = 0;

    function animateSegment() {
      if (wpIndex >= waypoints.length - 1) {
        // Animation complete - hide ship
        shipGroup.style.display = 'none';
        return;
      }

      var from = waypoints[wpIndex];
      var to = waypoints[wpIndex + 1];
      var dur = durations[wpIndex];
      var startTime = performance.now();

      function step(now) {
        var t = Math.min((now - startTime) / dur, 1);
        var et = ease(t);
        var x = from.x + (to.x - from.x) * et;
        var y = from.y + (to.y - from.y) * et;
        var op = from.opacity + (to.opacity - from.opacity) * et;
        shipGroup.setAttribute('transform', 'translate(' + x + ',' + y + ')');
        shipGroup.setAttribute('opacity', op);
        if (t < 1) {
          requestAnimationFrame(step);
        } else {
          wpIndex++;
          animateSegment();
        }
      }
      requestAnimationFrame(step);
    }

    animateSegment();
  }

  planet.addEventListener('click', launchShip);
  shipGroup.addEventListener('click', launchShip);
})();
]]></script>
</svg>
